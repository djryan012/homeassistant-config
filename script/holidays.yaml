#-------------------------------------------
# @CCOSTAN
# Original Repo : https://github.com/CCOSTAN/Home-AssistantConfig
# Youtube Video description of how I use this script
# https://www.vcloudinfo.com/2018/10/easy-smart-home-gadgets-i-use-for-my.html
######################################################################################################
###Script to turn on scene for the appropriate month for the front of the house but only when the sun is down.
#  action:
#   - service: script.monthly_color_scene
#
#   scenes should be named month_[01-12]_colors (month_06_colors)
# Color help - http://www.esbnyc.com/explore/tower-lights/calendar
######################################################################################################

######################################################################################################
# Falcon Player - FPP
# MQTT events will be published to "$prefix/falcon/player/$hostname/" with playlist events being in the "playlist" subtopic.
# FPP will respond to certain events:
# hassio/falcon/player/FPP/playlist/name/set -- Starts the plalist named in the payload
# hassio/falcon/player/FPP/playlist/repeat/set -- If payload is "1", will turn on repeat, otherwise it is turned off
# hassio/falcon/player/FPP/playlist/sectionPosition/set -- Payload contains an integer for the position in the playlist
# hassio/falcon/player/FPP/event/$MAJ_$MIN -- Starts the event identified by MAJ/MIN
# hassio/falcon/player/FPP/effect/start -- Starts the effect named in the payload
# hassio/falcon/player/FPP/effect/stop -- Stops the effect named in the payload or all effects if payload is empty
######################################################################################################

# 120 - Red, black and green in honor of Dr. Martin Luther King Jr. Day.
# 214 - Heartbeat Lighting in honor of Valentine's Day.
# 228 - New Orleans are green, gold, and purple for Marti Gras
# 317 - Orange, White and Green in honor of St Patrick's Day
# 419-421 - Pastel Colors in honor of Easter
# 504 - Starwars represent the dark side (red) and the light side (blue)
# 505 cinco_de_mayo - Red, White & Green for the Mexican Independence Day

monthly_color_scene:
  sequence:
    - service: mqtt.publish
      data_template:
        topic: hassio/falcon/player/FPP/playlist/name/set
        payload: >
          monthly_
          {%- if now().strftime("%m%d")|int == 101 -%}
          new_years_day
          {%- elif now().strftime("%m%d")|int == 120-%}
          mlk
          {%- elif now().strftime("%m%d")|int == 214-%}
          valentine
          {%- elif now().strftime("%m%d")|int >= 225
          and now().strftime("%m%d")|int <= 228-%}         
          marti_gras
          {%- elif now().strftime("%m%d")|int == 317 -%}
          st_patty
          {%- elif now().strftime("%m%d")|int >= 419
          and now().strftime("%m%d")|int <= 421-%}
          easter    
          {%- elif now().strftime("%m%d")|int == 504 -%}
          starwars
          {%- elif now().strftime("%m%d")|int == 505 -%}
          cinco_de_mayo
          {%- elif now().strftime("%m%d")|int >= 1001
          and now().strftime("%m%d")|int <= 1031-%}
          halloween
          {%- elif now().strftime("%m%d")|int >= 1122
          and now().strftime("%m%d")|int <= 1128-%}
          thanksgiving 
          {%- elif now().strftime("%m%d")|int >= 1201
          and now().strftime("%m%d")|int <= 1230-%}
          christmas
          {%- elif now().strftime("%m%d")|int == 1231 -%}
          new_years_eve
          {%- elif states.sensor.flag.state == "True" -%}
          rwb
          {%- else -%}
          standard
          {%- endif -%}_colors
    - delay:
        seconds: 5
    - service: mqtt.publish
      data_template:
        topic: hassio/falcon/player/FPP/playlist/repeat/set
        payload: '1'
        retain: false

monthly_color_off:
  sequence:
    - service: mqtt.publish
      data_template:
        topic: hassio/falcon/player/FPP/playlist/name/set
        payload: 'all_off'
        retain: false
    - delay:
        seconds: 5
    - service: mqtt.publish
      data_template:
        topic: hassio/falcon/player/FPP/playlist/repeat/set
        payload: '0'
        retain: false
